# OpenFront Projects

A Rush-based monorepo for managing OpenFront-related projects and packages.

## Overview

This repository uses [Microsoft Rush](https://rushjs.io/) to manage multiple packages in a scalable, efficient monorepo structure. It includes:

- **OpenFrontIO**: The main OpenFrontIO game (maintained as a git subtree)
- **Consistent Tooling**: Unified build, test, and lint configurations
- **Efficient Builds**: Parallel builds with intelligent caching
- **Dev Container**: Pre-configured VSCode development environment

## Quick Start

### Prerequisites

- Node.js 20.x or 22.x (LTS versions)
- npm 10.x or later
- Git

### Setup

**Quick Setup (Recommended):**

```bash
# Clone the repository
git clone https://github.com/bosconian-dynamics/openfront-projects.git
cd openfront-projects

# Run the setup script
./setup.sh        # For Linux/macOS
# or
./setup.ps1       # For Windows/PowerShell
```

**Manual Setup:**

```bash
# Clone the repository
git clone https://github.com/bosconian-dynamics/openfront-projects.git
cd openfront-projects

# Install Rush globally
npm install -g @microsoft/rush

# Install all package dependencies
rush update

# Build all packages
rush build
```

### Using VSCode Dev Container

This repository includes a dev container configuration:

1. Install the "Dev Containers" extension in VSCode
2. Open the repository in VSCode
3. Click "Reopen in Container" when prompted
4. The container will automatically set up the environment

## Repository Structure

```
openfront-projects/
├── .devcontainer/          # VSCode dev container configuration
├── .github/                # GitHub Actions workflows (auto-generated by Rush)
├── common/                 # Rush shared configuration
│   └── config/rush/        # Rush configuration files
├── docs/                   # Documentation
│   ├── AI_GUIDANCE.md     # Guidelines for AI/LLM assistance
│   ├── MONOREPO.md        # Monorepo structure and usage
│   └── SUBTREE.md         # Git subtree management guide
├── packages/               # All packages (1-2 levels deep)
│   └── OpenFrontIO/        # OpenFrontIO subtree from upstream (1 level)
└── rush.json               # Main Rush configuration
```

## Key Features

### Flexible Package Structure

Packages are organized with 1-2 level depth for flexibility:

```
packages/
  ├── [category]/          # e.g., apps, libraries, tools
  │   └── [package-name]/  # Individual package (2 levels - preferred)
  └── [package-name]/      # Direct package (1 level - special cases)
```

**Guidelines:**
- New packages should be 2 levels deep with proper categorization
- Special cases (like git subtrees) may be 1 level deep

### Git Subtree for OpenFrontIO

The `packages/OpenFrontIO` directory is maintained as a git subtree with a fork-based workflow:
- **Fork**: [bosconian-dynamics/OpenFrontIO](https://github.com/bosconian-dynamics/OpenFrontIO) (primary)
- **Upstream**: [openfrontio/OpenFrontIO](https://github.com/openfrontio/OpenFrontIO)

This allows:

- Working on OpenFrontIO within the monorepo
- Pushing changes to your fork
- Submitting PRs from fork to upstream
- Pulling updates from upstream
- Maintaining branch naming parity

See [docs/SUBTREE.md](docs/SUBTREE.md) for details.

### Package Manager

This monorepo uses **pnpm** (version 9.15.9) as the package manager, automatically managed by Rush.

## Common Commands

### Rush Commands

```bash
rush update          # Install/update all dependencies
rush build           # Build all packages
rush rebuild         # Clean and rebuild all packages
rush test            # Run tests for all packages
rush list            # List all packages in the monorepo
```

### Working with Individual Packages

```bash
cd packages/[category]/[package-name]
rushx <script-name>  # Run a package.json script
```

### Dependency Management

```bash
# In a package directory
rush add -p <package-name>        # Add a dependency
rush remove -p <package-name>     # Remove a dependency
```

## Documentation

- **[docs/MONOREPO.md](docs/MONOREPO.md)** - Detailed monorepo structure and usage guide
- **[docs/AI_GUIDANCE.md](docs/AI_GUIDANCE.md)** - Guidelines for AI assistants working with this codebase
- **[docs/ADDING_PACKAGES.md](docs/ADDING_PACKAGES.md)** - Step-by-step guide for adding new packages
- **[docs/SUBTREE.md](docs/SUBTREE.md)** - Git subtree management guide for OpenFrontIO

## Development Workflow

1. **Make Changes**: Edit code in any package
2. **Build**: Run `rush build` to build affected packages
3. **Test**: Run `rush test` to test your changes
4. **Commit**: Commit your changes following conventional commit guidelines
5. **Push**: Push to your branch and create a pull request

## Contributing

### Adding a New Package

1. Create the package directory (2 levels deep):
   ```bash
   mkdir -p packages/[category]/[package-name]
   ```

2. Create `package.json` in the package directory

3. Register the package in `rush.json`

4. Run `rush update`

See [docs/ADDING_PACKAGES.md](docs/ADDING_PACKAGES.md) for a complete step-by-step guide with examples.

### Working with OpenFrontIO

Pull updates from upstream:
```bash
git subtree pull --prefix=packages/OpenFrontIO openfront-upstream main --squash
```

Push changes to your fork:
```bash
git subtree push --prefix=packages/OpenFrontIO openfront-fork main
```

Then create a PR from your fork to upstream on GitHub.
```

## Technology Stack

- **Build System**: Rush 5.164.0
- **Package Manager**: pnpm 9.15.9
- **Runtime**: Node.js 20.x/22.x LTS
- **Languages**: TypeScript, JavaScript
- **Dev Container**: VSCode Dev Containers with Node.js 20

## Resources

- [Rush Documentation](https://rushjs.io/)
- [Rush Best Practices](https://rushjs.io/pages/best_practices/repo_setup/)
- [OpenFrontIO Fork](https://github.com/bosconian-dynamics/OpenFrontIO)
- [OpenFrontIO Upstream](https://github.com/openfrontio/OpenFrontIO)
- [pnpm Documentation](https://pnpm.io/)

## License

See individual package licenses for details.