# OpenFront Projects

A Rush-based monorepo for managing OpenFront-related projects and packages.

## Overview

This repository uses [Microsoft Rush](https://rushjs.io/) to manage multiple packages in a scalable, efficient monorepo structure. It includes:

- **OpenFrontIO**: The main OpenFrontIO game (maintained as a git subtree)
- **Consistent Tooling**: Unified build, test, and lint configurations
- **Efficient Builds**: Parallel builds with intelligent caching
- **Dev Container**: Pre-configured VSCode development environment

## Quick Start

### Prerequisites

- Node.js 20.x or 22.x (LTS versions)
- npm 10.x or later
- Git

### ðŸš€ First-Time Setup

This monorepo uses git worktrees for external dependencies. Before running Rush commands, you need to set up the worktrees:

**Linux/macOS:**
```bash
# Clone the repository
git clone https://github.com/bosconian-dynamics/openfront-projects.git
cd openfront-projects

# Run the setup script
./scripts/setup-worktrees.sh
rush update
rush build
```

**Windows (PowerShell):**
```powershell
# Clone the repository
git clone https://github.com/bosconian-dynamics/openfront-projects.git
cd openfront-projects

# Run the setup script
.\scripts\setup-worktrees.ps1
rush update
rush build
```

See [docs/WORKTREE_WORKFLOW.md](docs/WORKTREE_WORKFLOW.md) for detailed information about working with worktrees.

**Quick tip:** When adding dependencies to external packages for upstream contributions, use:
```bash
rush toggle-compat          # Auto-toggle to opposite mode
# ... make changes and commit ...
rush toggle-compat          # Auto-toggle back
```

### Alternative: Quick Setup Script

**Quick Setup (Uses existing setup scripts):**

```bash
# Clone the repository
git clone https://github.com/bosconian-dynamics/openfront-projects.git
cd openfront-projects

# Run the setup script
./setup.sh        # For Linux/macOS
# or
./setup.ps1       # For Windows/PowerShell
```

### Using VSCode Dev Container

This repository includes a dev container configuration:

1. Install the "Dev Containers" extension in VSCode
2. Open the repository in VSCode
3. Click "Reopen in Container" when prompted
4. The container will automatically set up the environment

## Repository Structure

```
openfront-projects/
â”œâ”€â”€ .devcontainer/          # VSCode dev container configuration
â”œâ”€â”€ .github/                # GitHub Actions workflows (auto-generated by Rush)
â”œâ”€â”€ common/                 # Rush shared configuration
â”‚   â”œâ”€â”€ config/rush/        # Rush configuration files
â”‚   â””â”€â”€ scripts/            # Monorepo automation scripts
â”‚       â”œâ”€â”€ modules/        # PowerShell modules
â”‚       â”œâ”€â”€ openfrontio-pull.ps1   # Pull OpenFrontIO updates
â”‚       â””â”€â”€ openfrontio-push.ps1   # Push OpenFrontIO changes
â”œâ”€â”€ docs/                   # Documentation
â”‚   â”œâ”€â”€ ADDING_PACKAGES.md # How to add new packages
â”‚   â”œâ”€â”€ MONOREPO.md        # Monorepo structure and usage
â”‚   â””â”€â”€ WORKTREE_WORKFLOW.md # Git worktree workflow guide
â”œâ”€â”€ AGENTS.md               # Guidelines for AI coding agents
â”œâ”€â”€ external/               # External packages (git worktrees)
â”‚   â””â”€â”€ openfrontio/        # OpenFrontIO worktree (setup required)
â”œâ”€â”€ packages/               # Internal packages (one level deep)
â”‚   â””â”€â”€ [package-name]/     # Individual package directories
â”œâ”€â”€ scripts/                # Monorepo setup scripts
â”‚   â”œâ”€â”€ setup-worktrees.sh  # Setup worktrees (Linux/macOS)
â”‚   â””â”€â”€ setup-worktrees.ps1 # Setup worktrees (Windows)
â””â”€â”€ rush.json               # Main Rush configuration
```

## Key Features

### Package Structure

Packages are organized one level deep within their category directory:

```
packages/
  â””â”€â”€ [package-name]/      # Individual package directory
  
external/
  â””â”€â”€ [package-name]/      # External package (worktree)
```

**Structure:**
- Package directories are always one level deep from their category
- Category directories (`packages/`, `external/`) exist at repo root
- Example: `packages/my-app/`, `external/openfrontio/`
- External packages use git worktrees (not tracked in monorepo)

### Git Worktree for OpenFrontIO

The `external/openfrontio` directory is maintained as a git worktree:
- **Repository**: [bosconian-dynamics/OpenFrontIO](https://github.com/bosconian-dynamics/OpenFrontIO)
- **Upstream**: [openfrontio/OpenFrontIO](https://github.com/openfrontio/OpenFrontIO)
- **Setup Required**: Run `./scripts/setup-worktrees.sh` after cloning

This allows:

- Working on OpenFrontIO within the monorepo
- Local-only modifications for Rush compatibility
- Pushing changes to your fork
- Submitting PRs to upstream
- Pulling updates from upstream
- Clean separation (worktree not tracked in monorepo)

See [docs/WORKTREE_WORKFLOW.md](docs/WORKTREE_WORKFLOW.md) for details.

### Package Manager

This monorepo uses **pnpm** (version 9.15.9) as the package manager, automatically managed by Rush.

## Common Commands

### Rush Commands

```bash
rush update          # Install/update all dependencies
rush build           # Build all packages
rush rebuild         # Clean and rebuild all packages
rush test            # Run tests for all packages
rush list            # List all packages in the monorepo
```

### Working with Individual Packages

```bash
cd packages/[category]/[package-name]
rushx <script-name>  # Run a package.json script
```

### Dependency Management

```bash
# In a package directory
rush add -p <package-name>        # Add a dependency
rush remove -p <package-name>     # Remove a dependency
```

## Documentation

- **[AGENTS.md](AGENTS.md)** - Guidelines for AI coding agents working with this codebase
- **[docs/MONOREPO.md](docs/MONOREPO.md)** - Detailed monorepo structure and usage guide
- **[docs/ADDING_PACKAGES.md](docs/ADDING_PACKAGES.md)** - Step-by-step guide for adding new packages
- **[docs/WORKTREE_WORKFLOW.md](docs/WORKTREE_WORKFLOW.md)** - Git worktree workflow guide for OpenFrontIO

## Development Workflow

1. **Make Changes**: Edit code in any package
2. **Build**: Run `rush build` to build affected packages
3. **Test**: Run `rush test` to test your changes
4. **Commit**: Commit your changes following conventional commit guidelines
5. **Push**: Push to your branch and create a pull request

## Contributing

### Adding a New Package

1. Create the package directory (2 levels deep):
   ```bash
   mkdir -p packages/[category]/[package-name]
   ```

2. Create `package.json` in the package directory

3. Register the package in `rush.json`

4. Run `rush update`

See [docs/ADDING_PACKAGES.md](docs/ADDING_PACKAGES.md) for a complete step-by-step guide with examples.

### Working with OpenFrontIO

Pull updates from upstream:
```bash
cd external/openfrontio
git pull
```

Push changes to your fork:
```bash
cd external/openfrontio
git push origin main
```

Then create a PR from your fork to upstream on GitHub.

See [docs/WORKTREE_WORKFLOW.md](docs/WORKTREE_WORKFLOW.md) for detailed workflow information.
```

## Technology Stack

- **Build System**: Rush 5.164.0
- **Package Manager**: pnpm 9.15.9
- **Runtime**: Node.js 20.x/22.x LTS
- **Languages**: TypeScript, JavaScript
- **Dev Container**: VSCode Dev Containers with Node.js 20

## Resources

- [Rush Documentation](https://rushjs.io/)
- [Rush Best Practices](https://rushjs.io/pages/best_practices/repo_setup/)
- [OpenFrontIO Fork](https://github.com/bosconian-dynamics/OpenFrontIO)
- [OpenFrontIO Upstream](https://github.com/openfrontio/OpenFrontIO)
- [pnpm Documentation](https://pnpm.io/)

## License

See individual package licenses for details.